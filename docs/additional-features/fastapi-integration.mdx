---
title: "FastAPI Integration"
description: "Serving your agencies and tools as APIs with FastAPI."
icon: "server"
---

Agency Swarm supports serving your agencies and tools as production-ready HTTP APIs using [FastAPI](https://fastapi.tiangolo.com/). This enables you to integrate your agents with other services or connect them to web frontends.

## Installation

FastAPI integration is an **optional installation**. To install all required dependencies, run:

```bash
pip install agency-swarm[fastapi]
```

## Setting Up FastAPI Endpoints

You can expose your agencies and tools as API endpoints using the `run_fastapi()` function.

### Example: Create an API endpoint for a single agency using the instance method

```python
from agency_swarm.agency import Agency

agency = Agency([ceo], name="test_agency")

agency.run_fastapi()
```

You can also pass optional arguments:
- `host` (default: `"0.0.0.0"`)
- `port` (default: `8000`)
- `app_token_env` (default: `"APP_TOKEN"`)

This creates two endpoints:
- `/test_agency/get_completion`
- `/test_agency/get_completion_stream`

Both endpoints accept parameters such as `message`, `recipient_agent`, `additional_instructions`, `message_files`, and more. You should also pass the previous `chat_history` dictionary (see hooks documentation for the exact format).
Responses include a `response` field with the agent reply and a `chat_history` field
containing the serialized conversation threads. The streaming endpoint sends
`chat_history` as the final event once generation is complete.

If the environment variable specified by `app_token_env` is set, a bearer token is required for all requests. Otherwise, authentication is disabled.

### Example: Serving Multiple Agencies and Tools with Factory Functions

Create factory functions in an `agency.py` file (or files) that build and return `Agency` instances. These factories should accept a `load_threads_callback` keyword argument so the integration can restore conversation history from each request. Import these factories in `main.py` and pass them to `run_fastapi` as a mapping:

```python
from pydantic import Field

from agency_swarm.agency import Agency
from agency_swarm.tools import BaseTool
from agency_swarm.integrations.fastapi import run_fastapi
from agency import create_agency_1, create_agency_2

# Example tools
class ExampleTool(BaseTool):
    example_field: str = Field(..., description="Example input.")
    def run(self):
        return "Result of ExampleTool operation"

class TestTool(BaseTool):
    example_field: str = Field(..., description="Example input.")
    def run(self):
        return "Result of TestTool operation"

run_fastapi(
    agencies={
        "agency_1": create_agency_1,
        "agency_2": create_agency_2,
    },
    tools=[ExampleTool, TestTool],
)
```

This launches endpoints:
- `/agency_1/get_completion`
- `/agency_1/get_completion_stream`
- `/agency_2/get_completion`
- `/agency_2/get_completion_stream`
- `/tool/ExampleTool`
- `/tool/TestTool`

Inputs for tool endpoints follow their Pydantic schemas.

---

## API Usage Example

You can interact with your agents and tools using HTTP requests. Here's an example using Python's `requests` library:

```python
import requests

agency_url = "http://127.0.0.1:8000/agency_1/get_completion"
payload = {
    "message": "Hello",
    "chat_history": {},  # send previous threads here
}
headers = {"Authorization": "Bearer 123"}

agency_response = requests.post(agency_url, json=payload, headers=headers)
print("Status code:", agency_response.status_code)
print("Response:", agency_response.json())

tool_url = "http://127.0.0.1:8000/tool/ExampleTool"
payload = {"example_field": "test"}

tool_response = requests.post(tool_url, json=payload, headers=headers)
print("Status code:", tool_response.status_code)
print("Response:", tool_response.json())
```

---

## Endpoint Structure

- **Agency Endpoints:**
  - `/your_agency_name/get_completion` (POST)
  - `/your_agency_name/get_completion_stream` (POST, streaming responses)
- **Tool Endpoints:**
  - `/tool/ToolClassName` (POST)

